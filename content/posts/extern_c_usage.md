+++
title = "Extern C 的用法"
author = ["colawithsauce"]
date = 2024-01-18T14:00:00+08:00
categories = ["CPP"]
draft = false
+++

## 原理 {#原理}

extern C 作用的域内，全部的函数与变量名都被编译成 C 的 ABI 格式。因此想要理解 extern C 只需要理解编译器与链接器的行为就好了。


## C++ 使用 C 函数 {#c-plus-plus-使用-c-函数}

因为如果我们直接 `#include` C 的头文件，如果是在 C 提供了 .c 的源代码的情况下，我们当然可以（大概是大部分时候吧）不用加 extern C，因为我们将使用 C++ 的方式来解释它们，而 C++ 是兼容 C 的。

但是如果我们只有头文件而没有源文件，即 C 代码是用共享库之类的方式给予我们的，我们就需要使用 extern C 来让 C++ 编译器在处理这些函数名的时候不要把它们处理成 C++ 的函数签名形式，而是 C 语言的函数签名模式。若非如此，代码将无法链接，提示无法找到 `__Zz_testfunc_int_int_` 之类的有非常奇怪名字的函数。


## C 使用 C++ 函数 {#c-使用-c-plus-plus-函数}

我们同样要将 C++ 想要暴露给 C 的接口使用 extern C 修饰，或者直接将这些接口在 `.h` 文件里面用 `extern "C" { ... }` 括起来。这样，C 就可以调用 C++ 的函数了。


## 其它问题 {#其它问题}


### 在C++代码中，在使用 extern C 修饰的函数中，我能否使用 C++ 函数？ {#在c-plus-plus-代码中-在使用-extern-c-修饰的函数中-我能否使用-c-plus-plus-函数}

这个问题是我作这番研究的原因，而研究完 extern C 的用法后，就应该明白，我们当然可以使用 C++ 函数。因为 extern C 只是告诉编译器要将这个函数名在编译目标文件时不要转换成 C++ 的函数签名，而是使用原名即 C 语言的函数签名形式。而接口是不影响实现要怎么样的。
